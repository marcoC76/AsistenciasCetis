<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>QR Scanner</title>
    <link rel="stylesheet" href="./style.css">

</head>

<body>
    <!-- partial:index.partial.html -->
    <!doctype html>
    <html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="author" content="ZXing for JS">

        <title>Qr scanner</title>
        <link rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
            href="https://fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
        <link rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
            href="https://unpkg.com/normalize.css@8.0.0/normalize.css">
        <link rel="preload" as="style" onload="this.rel='stylesheet';this.onload=null"
            href="https://unpkg.com/milligram@1.3.0/dist/milligram.min.css">
        <link rel="stylesheet" href="style.css">
    </head>

    <body>
        <center>


            <main class="wrapper" style="padding-top:2em">

                <section class="container" id="demo-content">
                    <h1 class="title">Scanner QR</h1>
                    <h1 class="text-3xl font-bold text-center">Carga de Asistencia</h1>
                    <div class="container mx-auto p-4">
                        <label for="profesor" class="block text-gray-700 text-sm font-bold mb-2">Nombre del
                            Profesor:</label>
                        <input type="text" id="profesor" name="profesor"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                            required><br><br>

                        <label for="periodo" class="block text-gray-700 text-sm font-bold mb-2">Periodo:</label>
                        <select id="periodo" name="periodo"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select><br><br>

                        <label for="materia" class="block text-gray-700 text-sm font-bold mb-2">Materia:</label>
                        <select id="materia" name="materia"
                            class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
                            <option value="lengua_comunicacion">Lengua y Comunicaci√≥n I (UAC)</option>
                            <option value="ingles_uac">Ingl√©s I (UAC)</option>
                            <option value="pensamiento_matematico">Pensamiento Matem√°tico I (UAC)</option>
                            <option value="cultura_digital">Cultura Digital I (UAC)</option>
                            <option value="materia_interacciones">La materia y sus interacciones (UAC)</option>
                            <option value="humanidades">Humanidades I (UAC)</option>
                            <option value="ciencias_sociales">Ciencias Sociales I (UAC)</option>
                            <option value="recursos_socioemocionales">Recursos Socioemocionales I (UAC)</option>
                            <option value="algebra">√Ålgebra</option>
                            <option value="leo_ei">L.E.O. y E. I</option>
                            <option value="quimica">Qu√≠mica I</option>
                            <option value="tic">Tec. de la Inf. y Comunicaci√≥n</option>
                            <option value="ingles">Ingl√©s I</option>
                            <option value="logica">L√≥gica</option>
                            <option value="propedeutico_enfermeria">Proped√©utico Enfermer√≠a</option>
                            <option value="propedeutico_radiologia">Proped√©utico Radiolog√≠a</option>
                            <option value="lengua_comunicacion_ii">Lengua y Comunicaci√≥n II (UAC)</option>
                            <option value="ingles_ii_uac">Ingl√©s II (UAC)</option>
                            <option value="pensamiento_matematico_ii">Pensamiento Matem√°tico II (UAC)</option>
                            <option value="cultura_digital_ii">Cultura Digital II (UAC)</option>
                            <option value="conservacion_energia">La conservaci√≥n de la energ√≠a y su (UAC)</option>
                            <option value="ciencias_sociales_ii">Ciencias Sociales II (UAC)</option>
                            <option value="recursos_socioemocionales_ii">Recursos Socioemocionales II (UAC)</option>
                            <option value="geometria_trigonometria">Geometr√≠a y Trigonometr√≠a</option>
                            <option value="leo_e_ii">L.E. O. y E. II</option>
                            <option value="quimica_ii">Qu√≠mica II</option>
                            <option value="ingles_ii">Ingl√©s II</option>
                            <option value="mod_i_sub_1_higiene_seguridad">Mod I Sub 1 Higiene y Seguridad</option>
                            <option value="mod_i_sub_2_salud_comunitaria">Mod I Sub 2 Salud Comunitaria</option>
                            <option value="mod_i_sub_1_proteccion_ionizantes">Mod I Sub I Protecci√≥n Ionizantes</option>
                            <option value="mod_i_sub_2_obtencion_imagen">Mod I Sub 2 Obtenci√≥n de Imagen</option>
                            <option value="lengua_comunicacion_iii">Lengua y Comunicaci√≥n III (UAC)</option>
                            <option value="ingles_iii_uac">Ingl√©s III (UAC)</option>
                            <option value="pensamiento_matematico_iii">Pensamiento Matem√°tico III (UAC)</option>
                            <option value="ecosistemas_interacciones">Ecosistemas, interacciones, energ√≠a y din√°mica (UAC)</option>
                            <option value="humanidades_ii">Humanidades II (UAC)</option>
                            <option value="recursos_socioemocionales_iii">Recursos Socioemocionales III</option>
                            <option value="geometria_analitica">Geometr√≠a Anal√≠tica</option>
                            <option value="etica">√âtica</option>
                            <option value="ingles_iii">Ingl√©s III</option>
                            <option value="biologia">Biolog√≠a</option>
                            <option value="mod_ii_sub_1_patologia">Mod II Sub 1 Patolog√≠a</option>
                            <option value="mod_ii_sub_2_procedimientos_bases_eticas_legales">Mod II Sub 2 Procedimientos Bases √âticas y Legales</option>
                            <option value="mod_ii_sub_1_estudios_radiograficos_simples">Mod II Sub I Estudios Radiogr√°ficos Simples</option>
                            <option value="mod_ii_sub_2_requerimientos_anatomicos_diagnostico">Mod II Sub 2 Requerimientos anat√≥micos de diagn√≥stico</option>
                        </select><br><br>
                        <!-- <p>
                        <a class="button-small button-outline" href="../../index.html">HOME üè°</a>
                    </p> -->

                        <!-- <p>This example shows how to scan a QR code with ZXing javascript library from the device video camera.
                        If more than one video input devices are available (for example front and back camera) the example
                        shows how to read them and use a select
                        to change the input device.</p> -->

                        <div>
                            <a class="button" id="startButton">Leer qr</a>
                            <a class="button" id="resetButton">Reset</a>
                        </div>

                        <div id="video-container">
                            <video id="video" width="300" height="200" style="border: 1px solid gray"></video>
                        </div>

                        <div id="sourceSelectPanel" style="display:none">
                            <label for="sourceSelect">Change video source:</label>
                            <select id="sourceSelect" style="max-width:400px">
                            </select>
                        </div>

                        <label>Resultado:</label>
                        <blockquote>
                            <p id="result"></p>
                        </blockquote>

                        <!--                 <p>See the <a href="https://github.com/zxing-js/library/tree/master/docs/examples/qr-camera/">source
                            code</a> for this example.</p> -->
                </section>

                <footer class="footer">
                    <!-- <section class="container">
                        <p>ZXing TypeScript Demo. Licensed under the <a target="_blank"
                                href="https://github.com/zxing-js/library#license" title="MIT">MIT</a>.</p>
                    </section> -->
                </footer>

            </main>
        </center>


        <script type="text/javascript" src="https://unpkg.com/@zxing/library@latest"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.2/howler.min.js"></script>
        <script type="text/javascript">
            const selectMateria = document.getElementById('materia');
            const selectPeriodo = document.getElementById('periodo');
            var jsonEntrada;
            function handleClick() {
                var Pro = document.getElementById('profesor').value;
                var Pe = selectPeriodo.value;
                var selectedValue = selectMateria.value;


                var url = 'https://script.google.com/macros/s/AKfycbwkfmGu3z0ApwRFCyZlidNpaQUNgP-f4INEl5BMkUnFDbE_S7dU3ikFvupkHNyx8zDd/exec?';

                const iframe = document.createElement('iframe');
                iframe.src = url + jsonEntrada + '&Pe=' + Pe + '&Pro=' + Pro + '&Ma=' + selectedValue;
                iframe.style.display = 'none';
                document.body.appendChild(iframe);
                /* if (selectedValue == "quimica") {
                    var url = 'https://script.google.com/macros/s/AKfycbwpcauPxYe3u4beWShRd2Tqjmsqc7xNhDKbdMCQRHkSCR_O9qbjxrP8gbYtatJ_E_5u/exec?';

                    const iframe = document.createElement('iframe');
                    iframe.src = url + jsonEntrada + '&Pe=' + Pe + '&Pro=' + Pro + '&Ma=' + selectedValue;
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);

                } else if (selectedValue == "matematicas") {
                    var url = 'https://script.google.com/macros/s/AKfycbwUJ_Wx9INcuyPf7pySFsVoWGjKDKCkEAvcn7RKLXnWnLKdzDVc_MKTHkCDlUVqYnO6/exec?';

                    const iframe = document.createElement('iframe');
                    iframe.src = url + jsonEntrada + '&Pe=' + Pe + '&Pro=' + Pro + '&Ma=' + selectedValue;
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);

                } else if (selectedValue == "fisica") {
                    var url = 'https://script.google.com/macros/s/AKfycbzbb1Zhi0ia_qVn4He2tE0tP08x1T3rQbjTDXUSPYyqk19y6fURyj2u7TcLaT6AVgRy/exec?';

                    const iframe = document.createElement('iframe');
                    iframe.src = url + jsonEntrada + '&Pe=' + Pe + '&Pro=' + Pro + '&Ma=' + selectedValue;
                    iframe.style.display = 'none';
                    document.body.appendChild(iframe);

                } */
                //que se abra un iframe invisible con un link 

                //que se abra un iframe invisible con un link 


            }
            window.addEventListener('load', function () {
                let selectedDeviceId;
                const codeReader = new ZXing.BrowserQRCodeReader()
                console.log('ZXing code reader initialized')
                codeReader.getVideoInputDevices()
                    .then((videoInputDevices) => {
                        let videoIndex = 0;



                        if (videoInputDevices.length >= 1) {
                            videoInputDevices.forEach((element) => {
                                console.log(element);
                            })
                            const sourceSelect = document.getElementById('sourceSelect')

                            // videoIndex = 1
                            console.log(videoInputDevices.length);
                            let length = videoInputDevices.length - 1;

                            if (videoInputDevices[length].deviceId) {
                                selectedDeviceId = videoInputDevices[length].deviceId;
                                document.getElementById('startButton').addEventListener('click', () => {
                                    codeReader.decodeFromInputVideoDevice(selectedDeviceId, 'video').then((result) => {
                                        console.log(result)
                                        document.getElementById('result').textContent = result.text
                                        jsonEntrada = result.text

                                        var sound = new Howl({
                                            src: ['https://marcoc76.github.io/audios/a-sudden-appearance-143034.mp3']
                                        });

                                        sound.play();
                                        handleClick();
                                        codeReader.reset();
                                    }).catch((err) => {
                                        console.error(err)
                                        document.getElementById('result').textContent = err
                                    })

                                    console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
                                })
                            } else {
                                document.getElementById('startButton').addEventListener('click', () => {
                                    codeReader.decodeFromInputVideoDevice(undefined, 'video').then((result) => {
                                        console.log(result)
                                        document.getElementById('result').textContent = result.text
                                        var sound = new Howl({
                                            src: ['https://d1490khl9dq1ow.cloudfront.net/sfx/mp3preview/jg-032316-sfx-elearning-correct-answer-sound-1.mp3']
                                        });

                                        sound.play();
                                    }).catch((err) => {
                                        console.error(err)
                                        document.getElementById('result').textContent = err
                                    })

                                    console.log(`Started continous decode from camera with id ${selectedDeviceId}`)
                                })
                            }
                            console.log(length);
                            console.log(selectedDeviceId);
                        }

                        document.getElementById('resetButton').addEventListener('click', () => {
                            codeReader.reset()
                            console.log('Reset.')
                        })
                    })
                    .catch((err) => {
                        console.error(err)
                    })
            })
        </script>

    </body>

    </html>
    <!-- partial -->
    <script src='https://cdnjs.cloudflare.com/ajax/libs/howler/2.1.2/howler.min.js'></script>
    <script src="./script.js"></script>

</body>

</html>